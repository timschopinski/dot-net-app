@page
@{
    ViewData["Title"] = "Rejestracja";
}

<div class="card" style="max-width: 500px; margin: 50px auto;">
    <h2>Rejestracja</h2>
    <div id="error" class="alert alert-error" style="display: none;"></div>
    <form id="registerForm">
        <div class="form-group">
            <label>Nazwa użytkownika:</label>
            <input type="text" id="username" required>
        </div>
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email" required>
        </div>
        <div class="form-group">
            <label>Hasło:</label>
            <input type="password" id="password" required minlength="6">
        </div>
        <button type="submit" class="btn btn-success">Zarejestruj</button>
        <a href="/login" class="btn">Mam już konto</a>
    </form>
</div>

@section Scripts {
    <script>
    document.getElementById('registerForm').onsubmit = async (e) => {
        e.preventDefault();
        const data = {
            username: document.getElementById('username').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        };
        const res = await fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        if (res.ok) {
            const result = await res.json();
            localStorage.setItem('token', result.token);
            localStorage.setItem('username', result.username);
            window.location.href = '/';
        } else {
            const error = await res.json();
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = error.message || 'Błąd rejestracji';
        }
    };
</script>
}