@page
@{
    ViewData["Title"] = "Logowanie";
}

<div class="card" style="max-width: 500px; margin: 50px auto;">
    <h2>Logowanie</h2>
    <div id="error" class="alert alert-error" style="display: none;"></div>
    <form id="loginForm">
        <div class="form-group">
            <label>Nazwa użytkownika:</label>
            <input type="text" id="username" required>
        </div>
        <div class="form-group">
            <label>Hasło:</label>
            <input type="password" id="password" required>
        </div>
        <button type="submit" class="btn btn-success">Zaloguj</button>
        <a href="/register" class="btn">Zarejestruj się</a>
    </form>
</div>

@section Scripts {
    <script>
    document.getElementById('loginForm').onsubmit = async (e) => {
        e.preventDefault();
        const data = {
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };
        const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        if (res.ok) {
            const result = await res.json();
            localStorage.setItem('token', result.token);
            localStorage.setItem('username', result.username);
            window.location.href = '/';
        } else {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = 'Nieprawidłowa nazwa użytkownika lub hasło';
        }
    };
</script>
}